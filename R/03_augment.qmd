---
title: "03_augment"
format: html
editor: visual
---

```{r}
# Output: FALSE
library(tidyverse)
library(broom)
```

```{r}
# Output: FALSE
# Loading the clean dataset
data = read_tsv("../../data/cleaned_meta_gene_table.tsv")
```

## Standardize gene expression values

```{r}
# lists of meta data columns and gene columns
meta_cols <- c('Sample',
               'Gender',
               'Race',
               'Smoker',
               'Age',
               'BMI')

gene_cols <- data |> 
  select(-one_of(meta_cols)) |> 
  colnames()
```

```{r}
# group expression by genes and scale to 0 mean and 1 st. dev.

aug_data <- data |>
  mutate(std_Lesion = 
           (Lesion - mean(Lesion))/sd(Lesion)) |> 
  mutate(std_Perilesion = 
           (Perilesion - mean(Perilesion)/sd(Perilesion))) |> 
  mutate(log2_Lesion = 
           if_else(Lesion == 0, 
                   0, 
                   log2(Lesion)
                   )
         ) |> 
   mutate(log2_Perilesion = 
           if_else(Perilesion == 0, 
                   0, 
                   log2(Perilesion)
                   )
         ) |> 
   mutate(log2_expr_change = 
           if_else(expr_diff == 0, 
                   0, 
                   log2(expr_diff)
                   )
         ) 
```

```{r}
# We save the augmented data frame
write_tsv(aug_data, 
          file = "../../data/augmented_meta_gene_table.tsv")
```
