---
title: "05_expression_significance"
format: html
editor: visual
---

## The idea

The dataset at full contains 58.046 genes with their expression values for each of the 40 observations. To filter out the uninformative genes to the lesion/paralesion groups, a Student's t-Test could be performed on the scaled expressions. Genes with significant expression differences (p\<0.05) could be kept for further analysis.

```{r}
library(tidyverse)
```

```{r}
# load data
data <- read_tsv('../data/augmented_meta_gene_table.tsv')
```

```{r}
# lists of meta data columns and gene columns

meta_cols <- c('Sample',
               'Tissue_type',
               'Gender',
               'Race',
               'Smoker',
               'Age',
               'BMI')

gene_cols <- data |> 
  select(-one_of(meta_cols)) |> 
  colnames()
```

```{r}
# THIS SECTION IS IN PROGRESS 
long_data_nested <- data |>
  mutate(Tissue_type = case_when(Tissue_type == "Lesion" ~ 1,
                                 Tissue_type == "Perilesion" ~ 0)) |> 
  pivot_longer(all_of(gene_cols),
               names_to = 'gene',
               values_to = 'scaled_expr') |> 
  group_by(gene) |> 
  nest() |> 
  mutate('model_object' = map(.x = data,
                   .f = ~lm(formula = scaled_expr ~ Tissue_type,
                            data = .x))) #|> 
  #mutate(model_object_tidy = map(.x = model_object,
  #                              ~tidy(.x,
  #                                     conf.int = TRUE,
  #                                     conf.level = 0.95)))
```

```{r}
data$ENSG00000068985
```
